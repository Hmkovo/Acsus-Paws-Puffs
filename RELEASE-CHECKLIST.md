# 发布前检查清单

> **用途：** 每次发布新版本前，按这个清单逐项检查，避免发布有问题的版本。

---

## 📋 发布流程

### 第一步：代码质量检查

- [ ] **关闭日志开关**：`logger.js` 中 `ENABLE_LOGGING = false`
- [ ] **删除调试代码**：搜索并删除所有 `console.log`、`debugger`
- [ ] **移除 TODO**：搜索 `TODO`、`FIXME`，确认是否需要完成或删除
- [ ] **检查敏感信息**：确认没有 API key、测试数据、私人信息
- [ ] **清理临时文件**：删除 `.log` 文件、临时测试文件

---

### 第二步：功能测试

#### 字体管理器
- [ ] 添加字体（Google Fonts 和 zeoseven 格式）
- [ ] 删除字体
- [ ] 切换字体（确认应用到所有元素）
- [ ] 标签分类（添加、删除、筛选）
- [ ] 导入导出配置
- [ ] 搜索功能
- [ ] 分页功能

#### 预设管理器
- [ ] 预设收纳（收纳、取消收纳、折叠展开）
- [ ] 清空收纳功能
- [ ] 收纳状态保存和加载
- [ ] 世界书工具折叠栏显示正常
- [ ] 图标状态正确（文件夹、箭头、星号）

#### 世界书工具
- [ ] 选择世界书，列表正常显示
- [ ] 添加条目（可选条目列表）
- [ ] 关键词匹配功能
- [ ] 常驻模式功能
- [ ] 编辑条目（所有字段）
- [ ] 删除条目
- [ ] 导入导出配置
- [ ] 深度控制正常工作

#### 可视化编辑器（如果已实现）
- [ ] 中文 CSS 编译开关
- [ ] 可视化编辑面板开关
- [ ] 元素选择和属性编辑
- [ ] 清理功能

---

### 第三步：兼容性测试

- [ ] **全新环境测试**：清空 localStorage，重新加载扩展
- [ ] **浏览器兼容**：Chrome / Edge / Firefox 至少测试一个
- [ ] **SillyTavern 版本**：在最新稳定版测试
- [ ] **主题兼容**：切换浅色/深色主题，确认样式正常
- [ ] **移动端测试**：F12 切换到移动设备视图，检查响应式布局

---

### 第四步：文档更新

- [ ] **更新 CHANGELOG.md**：
  - 添加本次版本的所有变更
  - 分类：Added / Changed / Fixed / Removed
  - 日期和版本号
  
- [ ] **更新版本号**：
  - `manifest.json` 中的 `version` 字段
  - `CHANGELOG.md` 中的版本号和日期
  
- [ ] **更新 README.md**（如果有功能变化）：
  - 新增功能说明
  - 更新截图/GIF（如果 UI 有变化）
  - 更新使用方法

- [ ] **更新项目地图**：
  - 检查文件列表是否最新
  - 更新文件行数
  - 更新总文件数

---

### 第五步：Git 操作

- [ ] **Commit 规范检查**：
  - 所有 commit 消息符合约定式提交格式
  - 例：`feat: 添加xxx功能`、`fix: 修复xxx问题`
  
- [ ] **创建版本标签**：
  ```bash
  git tag -a v2.1.0 -m "Release v2.1.0"
  git push origin v2.1.0
  ```

- [ ] **推送到 GitHub**：
  ```bash
  git push origin main
  ```

---

### 第六步：发布后验证

- [ ] **下载发布版本**：从 GitHub 下载，确认所有文件都包含
- [ ] **安装测试**：在新的 SillyTavern 环境安装，测试功能
- [ ] **检查文件大小**：确认没有异常大的文件（如未压缩的图片）
- [ ] **检查加载速度**：扩展加载时间是否正常

---

## 🚨 常见问题排查

### 加载失败
- 检查 `manifest.json` 格式是否正确
- 检查是否有语法错误（F12 控制台查看）
- 检查导入路径是否正确

### 功能异常
- 检查 `ENABLE_LOGGING` 是否已关闭
- 检查是否有遗漏的 `console.log`
- 检查数据是否正确保存到 `extension_settings`

### 样式问题
- 检查是否使用了 ST 主题变量
- 检查是否有硬编码的颜色
- 检查不同主题下的显示效果

---

## 📝 发布记录模板

```markdown
## 发布时间：2025-xx-xx
## 版本：v2.x.x
## 检查人：xxx

### 测试环境
- SillyTavern 版本：1.12.x
- 浏览器：Chrome xxx
- 操作系统：Windows 10

### 测试结果
- [ ] 所有功能正常
- [ ] 文档已更新
- [ ] 无控制台错误
- [ ] 性能正常

### 备注
（记录特殊情况或需要注意的事项）
```

---

**维护者：** 白沉 ＆ 溯  
**最后更新：** 2025-10-05

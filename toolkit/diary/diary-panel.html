<!-- 日记面板 - 轮播图模式 -->
<div class="diary-panel" id="diaryPanel">
  <!-- 顶部工具栏：左侧功能组 + 右侧关闭 -->
  <div class="diary-toolbar">
    <!-- 左侧功能组：设置 + 搜索 + 筛选 + 周切换 -->
    <div class="diary-toolbar-left">
      <!-- 设置按钮 -->
      <button class="diary-settings-btn" id="diarySettingsBtn" title="日记设置">
        <span class="fa-solid fa-cog"></span>
      </button>

      <!-- 搜索按钮 -->
      <button class="diary-search-toggle-btn" id="diarySearchToggleBtn" title="搜索日记">
        <span class="fa-solid fa-search"></span>
      </button>

      <!-- 预设按钮 -->
      <button class="diary-preset-toggle-btn" id="diaryPresetBtn" title="预设管理">
        <span class="fa-solid fa-list"></span>
      </button>

      <!-- 视觉设置按钮 -->
      <button class="diary-visual-toggle-btn" id="diaryVisualBtn" title="自定义视觉">
        <span class="fa-solid fa-user-cog"></span>
      </button>

      <!-- 筛选下拉 -->
      <select class="diary-filter-select" id="diaryFilterSelect">
        <option value="all">全部</option>
        <option value="user">我的</option>
        <option value="ai">AI的</option>
        <option value="week">本周</option>
        <option value="month">本月</option>
        <option value="date">日期</option>
        <option value="dateRange">日期范围</option>
      </select>
    </div>

    <!-- 右侧关闭按钮 -->
    <button class="diary-close-btn" title="关闭">
      <span class="fa-solid fa-times"></span>
    </button>
  </div>

  <!-- 展开式设置面板（默认隐藏） -->
  <div class="diary-settings-panel" id="diarySettingsPanel">
    <div class="diary-settings-content">

      <!-- 标题：生成评论时包含的上下文 -->
      <div class="diary-setting-group-title">📝 生成评论时包含的上下文：</div>

      <!-- 用户设定 -->
      <label class="diary-setting-item diary-setting-checkbox">
        <input type="checkbox" id="diaryIncludePersonaDescription" checked />
        <span>用户设定 (Persona Description)</span>
      </label>

      <!-- 角色信息 -->
      <label class="diary-setting-item diary-setting-checkbox">
        <input type="checkbox" id="diaryIncludeCharDescription" checked />
        <span>角色描述 (Description)</span>
      </label>

      <label class="diary-setting-item diary-setting-checkbox">
        <input type="checkbox" id="diaryIncludeCharPersonality" checked />
        <span>角色性格 (Personality)</span>
      </label>

      <label class="diary-setting-item diary-setting-checkbox">
        <input type="checkbox" id="diaryIncludeCharScenario" checked />
        <span>角色场景 (Scenario)</span>
      </label>

      <!-- 世界书 -->
      <label class="diary-setting-item diary-setting-checkbox">
        <input type="checkbox" id="diaryIncludeWorldInfo" checked />
        <span>世界书（常驻条目）</span>
      </label>

      <!-- 最近对话 -->
      <label class="diary-setting-item">
        <input type="checkbox" id="diaryIncludeRecentChat" checked />
        <span>最近对话（最多</span>
        <input type="number" id="diaryRecentChatCount" min="1" max="20" value="5" class="diary-setting-input-inline"
          style="width: 50px; margin: 0 5px;" />
        <span>条）</span>
      </label>

      <!-- 历史日记 -->
      <label class="diary-setting-item">
        <input type="checkbox" id="diaryIncludeHistoryDiaries" />
        <span>历史日记（最多</span>
        <input type="number" id="diaryHistoryDiaryCount" min="1" max="10" value="3" class="diary-setting-input-inline"
          style="width: 50px; margin: 0 5px;" />
        <span>条）</span>
      </label>

      <hr style="margin: 10px 0; border-top: 1px solid var(--SmartThemeBorderColor); opacity: 0.3;">

      <!-- 标题：评论设置 -->
      <div class="diary-setting-group-title">💬 评论设置：</div>

      <label class="diary-setting-item diary-setting-checkbox">
        <input type="checkbox" id="diaryDisableCharacterCommentCheckbox" />
        <span>关闭角色评论</span>
      </label>

      <label class="diary-setting-item diary-setting-checkbox">
        <input type="checkbox" id="diaryAllowPasserbyCheckbox" />
        <span>允许路人评论（AI可随机名字评论）</span>
      </label>

      <label class="diary-setting-item">
        <span class="diary-setting-label">路人评论数量：</span>
        <input type="number" id="diaryPasserbyCommentMin" min="1" max="50" value="3" class="diary-setting-input-inline"
          style="width: 50px; margin: 0 5px;" />
        <span>~</span>
        <input type="number" id="diaryPasserbyCommentMax" min="1" max="50" value="5" class="diary-setting-input-inline"
          style="width: 50px; margin: 0 5px;" />
        <span>条</span>
      </label>

      <label class="diary-setting-item">
        <span class="diary-setting-label">路人性格类型：</span>
        <select id="diaryPasserbyPersonalitySelect" class="diary-setting-select">
          <option value="default">默认观众</option>
          <option value="funny">搞笑观众</option>
          <option value="fanclub">饭圈观众</option>
          <option value="fanficauthor">二创太太</option>
          <option value="analysis">分析观众</option>
          <option value="critic">烂梗吐槽役</option>
          <option value="lore">设定考据党</option>
          <option value="pessimist">悲观预言家</option>
          <option value="shipper">CP粉</option>
          <option value="alien">外星观察员</option>
          <option value="gamer">第四天灾玩家</option>
          <option value="crossovermaniac">串台乱入者</option>
          <option value="chaos">混乱拱火乐子人</option>
          <option value="pragmatic">功利不择手段者</option>
          <option value="vmefifty">好兄弟v我50</option>
        </select>
      </label>

      <hr style="margin: 10px 0; border-top: 1px solid var(--SmartThemeBorderColor); opacity: 0.3;">

      <!-- 标题：交互设置 -->
      <div class="diary-setting-group-title">🎯 交互设置：</div>

      <!-- 删除评论时是否询问 -->
      <label class="diary-setting-item diary-setting-checkbox">
        <input type="checkbox" id="diarySkipDeleteConfirm" />
        <span>删除评论时不再询问（直接删除）</span>
      </label>

      <hr style="margin: 10px 0; border-top: 1px solid var(--SmartThemeBorderColor); opacity: 0.3;">

      <!-- 标题：API 设置 -->
      <div class="diary-setting-group-title">🔌 API 设置：</div>

      <!-- API 来源选择 -->
      <label class="diary-setting-item">
        <span class="diary-setting-label">API 来源：</span>
        <select id="diaryApiSource" class="diary-setting-select">
          <option value="default">跟随酒馆设置（默认）</option>
          <option value="custom">自定义 API</option>
        </select>
      </label>

      <!-- 流式开关 -->
      <label class="diary-setting-item diary-setting-checkbox">
        <input type="checkbox" id="diaryApiStream" />
        <span>流式生成（实时显示）</span>
      </label>

      <!-- 自定义 API 配置区域（默认隐藏） -->
      <div id="diaryCustomApiSettings" class="diary-custom-api-settings" style="display: none;">

        <!-- API 类型选择（完整官方列表） -->
        <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start;">
          <span class="diary-setting-label">API 类型：</span>
          <select id="diaryApiFormat" class="diary-setting-select" style="width: 100%;">
            <optgroup label="常用">
              <option value="openai">OpenAI</option>
              <option value="claude">Claude (Anthropic)</option>
              <option value="makersuite">Google AI (Gemini)</option>
              <option value="openrouter">OpenRouter</option>
              <option value="deepseek">DeepSeek</option>
            </optgroup>
            <optgroup label="其他官方API">
              <option value="ai21">AI21</option>
              <option value="aimlapi">AI/ML API</option>
              <option value="azure_openai">Azure OpenAI</option>
              <option value="chutes">Chutes</option>
              <option value="cohere">Cohere</option>
              <option value="electronhub">Electron Hub</option>
              <option value="fireworks">Fireworks AI</option>
              <option value="groq">Groq</option>
              <option value="mistralai">MistralAI</option>
              <option value="moonshot">Moonshot AI</option>
              <option value="nanogpt">NanoGPT</option>
              <option value="perplexity">Perplexity</option>
              <option value="pollinations">Pollinations</option>
              <option value="siliconflow">SiliconFlow</option>
              <option value="vertexai">Vertex AI</option>
              <option value="xai">xAI (Grok)</option>
              <option value="zai">Z.AI (GLM)</option>
            </optgroup>
            <optgroup label="通用">
              <option value="custom">自定义（OpenAI兼容）</option>
            </optgroup>
          </select>
        </label>

        <!-- ========== 各 API 类型的配置表单 ========== -->

        <!-- 通用 API 密钥区块 -->
        <div id="diaryApiKeySection" class="diary-api-section" data-diary-source="openai,claude,makersuite,deepseek,mistralai,cohere,perplexity,groq,xai,ai21,moonshot,fireworks,electronhub,chutes,nanogpt,aimlapi,siliconflow,zai">
          <label class="diary-setting-item">
            <span class="diary-setting-label">API 密钥：</span>
            <div style="display: flex; gap: 8px; align-items: center; width: 100%;">
              <input type="password" id="diaryApiKey" placeholder="sk-..." class="text_pole" style="flex: 1;" />
              <button class="menu_button" id="diaryApiKeyToggle" title="显示/隐藏密钥">
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>
          </label>
          <div class="diary-setting-hint">出于隐私考虑，保存后密钥将被隐藏</div>
        </div>

        <!-- 反向代理配置（折叠式） -->
        <div id="diaryReverseProxySection" class="diary-api-section" data-diary-source="openai,claude,mistralai,makersuite,vertexai,deepseek,xai" style="display: none;">
          <div class="diary-setting-label diary-collapsible-header" id="diaryReverseProxyToggle">
            <i class="fa-solid fa-chevron-right" id="diaryReverseProxyIcon"></i>
            <span>反向代理</span>
          </div>
          <div id="diaryReverseProxyContent" class="diary-collapsible-content" style="display: none;">
            <!-- 代理预设选择 -->
            <div class="diary-setting-row">
              <select id="diaryProxyPreset" class="diary-setting-select" style="flex: 1;">
                <option value="">无</option>
              </select>
              <button id="diaryProxySave" class="menu_button" title="保存代理">
                <i class="fa-solid fa-floppy-disk"></i>
              </button>
              <button id="diaryProxyDelete" class="menu_button diary-btn-danger" title="删除代理">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>
            <!-- 代理服务器 URL -->
            <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
              <span class="diary-setting-hint">代理服务器 URL</span>
              <input type="text" id="diaryReverseProxyUrl" class="text_pole" placeholder="https://api.openai.com/v1" style="width: 100%;" />
              <div class="diary-setting-hint">备用服务器URL（留空使用默认值）。不行？试试在末尾添加 <code>/v1</code></div>
            </label>
            <!-- 代理密码 -->
            <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
              <span class="diary-setting-hint">代理密码</span>
              <div style="display: flex; gap: 8px; align-items: center; width: 100%;">
                <input type="password" id="diaryReverseProxyPassword" class="text_pole" placeholder="将用作代理密码，而不是API密钥" style="flex: 1;" />
                <button id="diaryReverseProxyPasswordToggle" class="menu_button">
                  <i class="fa-solid fa-eye"></i>
                </button>
              </div>
            </label>
            <div class="diary-setting-hint diary-warning" style="margin-top: 8px;">
              <i class="fa-solid fa-exclamation-triangle"></i> 使用非自建代理有数据隐私风险
            </div>
          </div>
        </div>

        <!-- OpenRouter 专用配置 -->
        <div id="diaryOpenRouterSection" class="diary-api-section" data-diary-source="openrouter" style="display: none;">
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start;">
            <span class="diary-setting-label">OpenRouter API 密钥</span>
            <div class="diary-setting-hint" style="margin-bottom: 4px;">
              点击下方授权或从 <a href="https://openrouter.ai/keys/" target="_blank">OpenRouter</a> 获取密钥。
              <a href="https://openrouter.ai/account" target="_blank">查看剩余额度</a>
            </div>
            <div style="display: flex; gap: 8px; align-items: center; width: 100%;">
              <input type="password" id="diaryOpenRouterKey" class="text_pole" placeholder="sk-or-..." style="flex: 1;" />
              <button id="diaryOpenRouterKeyToggle" class="menu_button">
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>
          </label>
          <button id="diaryOpenRouterAuth" class="menu_button diary-btn-primary" style="margin-top: 8px;">
            <i class="fa-solid fa-key"></i> 授权
          </button>
        </div>

        <!-- Custom 专用配置（自定义端点） -->
        <div id="diaryCustomSection" class="diary-api-section" data-diary-source="custom" style="display: none;">
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start;">
            <span class="diary-setting-label">自定义端点（Base URL）</span>
            <input type="text" id="diaryApiBaseUrl" class="text_pole" placeholder="例如：http://localhost:1234/v1" style="width: 100%;" />
            <div class="diary-setting-hint">不行？试试在URL末尾添加 <code>/v1</code>。<code>/chat/completions</code> 后缀会自动补全。</div>
          </label>
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
            <span class="diary-setting-label">自定义 API 密钥 <small style="opacity: 0.7;">（可选）</small></span>
            <div style="display: flex; gap: 8px; align-items: center; width: 100%;">
              <input type="password" id="diaryCustomApiKey" class="text_pole" placeholder="sk-..." style="flex: 1;" />
              <button id="diaryCustomApiKeyToggle" class="menu_button">
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>
          </label>
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
            <span class="diary-setting-label">输入模型名</span>
            <input type="text" id="diaryCustomModelId" class="text_pole" list="diaryCustomModelList" placeholder="例如：gpt-4o" style="width: 100%;" />
            <datalist id="diaryCustomModelList"></datalist>
          </label>
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
            <span class="diary-setting-label">可用模型</span>
            <div class="diary-setting-row">
              <select id="diaryCustomModelSelect" class="diary-setting-select" style="flex: 1;">
                <option value="">无</option>
              </select>
              <button id="diaryCustomRefreshModels" class="menu_button" title="刷新模型列表">
                <i class="fa-solid fa-rotate"></i>
              </button>
            </div>
          </label>
        </div>

        <!-- Vertex AI 专用配置 -->
        <div id="diaryVertexAISection" class="diary-api-section" data-diary-source="vertexai" style="display: none;">
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start;">
            <span class="diary-setting-label">认证模式</span>
            <select id="diaryVertexAuthMode" class="diary-setting-select" style="width: 100%;">
              <option value="express">Express 模式（API Key）</option>
              <option value="full">完整版（服务账号）</option>
            </select>
          </label>
          <!-- Express 模式 -->
          <div id="diaryVertexExpressConfig" style="margin-top: 8px;">
            <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start;">
              <span class="diary-setting-label">API 密钥</span>
              <div style="display: flex; gap: 8px; align-items: center; width: 100%;">
                <input type="password" id="diaryVertexApiKey" class="text_pole" placeholder="AIza..." style="flex: 1;" />
                <button id="diaryVertexApiKeyToggle" class="menu_button">
                  <i class="fa-solid fa-eye"></i>
                </button>
              </div>
              <div class="diary-setting-hint"><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/start/express-mode/overview" target="_blank">Express 模式文档</a></div>
            </label>
            <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
              <span class="diary-setting-label">项目 ID <small style="opacity: 0.7;">（可选）</small></span>
              <input type="text" id="diaryVertexProjectId" class="text_pole" placeholder="your-project-id" style="width: 100%;" />
              <div class="diary-setting-hint">非 us-central1 区域时需要填写。可在 404 错误信息中找到。</div>
            </label>
          </div>
          <!-- Full 模式 -->
          <div id="diaryVertexFullConfig" style="margin-top: 8px; display: none;">
            <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start;">
              <span class="diary-setting-label">服务账号 JSON</span>
              <textarea id="diaryVertexServiceAccount" class="text_pole" rows="4" placeholder='{"type": "service_account", ...}' style="width: 100%; resize: vertical;"></textarea>
              <div class="diary-setting-hint">粘贴完整的服务账号 JSON 内容。<a href="https://cloud.google.com/vertex-ai/docs/authentication" target="_blank">认证文档</a></div>
            </label>
          </div>
          <!-- 区域 -->
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
            <span class="diary-setting-label">区域</span>
            <input type="text" id="diaryVertexRegion" class="text_pole" list="diaryVertexRegionList" value="us-central1" placeholder="us-central1" style="width: 100%;" />
            <datalist id="diaryVertexRegionList">
              <option value="global">global</option>
              <option value="us-central1">us-central1</option>
              <option value="us-east1">us-east1</option>
              <option value="us-west1">us-west1</option>
              <option value="europe-west1">europe-west1</option>
              <option value="europe-west4">europe-west4</option>
              <option value="asia-northeast1">asia-northeast1</option>
              <option value="asia-southeast1">asia-southeast1</option>
            </datalist>
            <div class="diary-setting-hint"><a href="https://cloud.google.com/vertex-ai/generative-ai/docs/learn/locations" target="_blank">查看可用区域</a></div>
          </label>
        </div>

        <!-- Azure OpenAI 专用配置 -->
        <div id="diaryAzureSection" class="diary-api-section" data-diary-source="azure_openai" style="display: none;">
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start;">
            <span class="diary-setting-label">Azure Base URL</span>
            <input type="text" id="diaryAzureBaseUrl" class="text_pole" placeholder="https://your-resource.openai.azure.com/" style="width: 100%;" />
            <div class="diary-setting-hint">Azure OpenAI 资源的端点 URL</div>
          </label>
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
            <span class="diary-setting-label">部署名称</span>
            <input type="text" id="diaryAzureDeploymentName" class="text_pole" placeholder="your-deployment-name" style="width: 100%;" />
            <div class="diary-setting-hint">Azure 中模型部署的名称</div>
          </label>
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
            <span class="diary-setting-label">API 版本</span>
            <select id="diaryAzureApiVersion" class="diary-setting-select" style="width: 100%;">
              <option value="2025-04-01-preview">2025-04-01-preview</option>
              <option value="2024-10-21">2024-10-21</option>
              <option value="2024-02-15-preview">2024-02-15-preview</option>
            </select>
          </label>
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
            <span class="diary-setting-label">Azure API 密钥</span>
            <div style="display: flex; gap: 8px; align-items: center; width: 100%;">
              <input type="password" id="diaryAzureApiKey" class="text_pole" placeholder="your-azure-api-key" style="flex: 1;" />
              <button id="diaryAzureApiKeyToggle" class="menu_button">
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>
          </label>
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start; margin-top: 8px;">
            <span class="diary-setting-label">模型名称</span>
            <input type="text" id="diaryAzureModelName" class="text_pole" placeholder="gpt-4o" style="width: 100%;" />
            <div class="diary-setting-hint">部署的底层模型名称（如 gpt-4o、gpt-4-turbo）</div>
          </label>
        </div>

        <!-- Pollinations 专用（免费，无需密钥） -->
        <div id="diaryPollinationsSection" class="diary-api-section" data-diary-source="pollinations" style="display: none;">
          <div class="diary-setting-hint">
            <a href="https://pollinations.ai/" target="_blank" rel="noopener noreferrer">由 Pollinations.AI 免费提供</a><br>
            请避免发送敏感信息。输出可能包含提供商的广告。
          </div>
        </div>

        <!-- Chutes 专用配置 -->
        <div id="diaryChutesSection" class="diary-api-section" data-diary-source="chutes" style="display: none;">
          <div class="diary-setting-hint">
            <a href="https://chutes.ai/app/api/billing-balance" target="_blank" rel="noopener noreferrer">查看账单/余额</a>
          </div>
        </div>

        <!-- ========== 模型选择（非 Custom API 使用） ========== -->
        <div id="diaryModelSection" class="diary-api-section" data-diary-source="openai,claude,makersuite,openrouter,deepseek,mistralai,cohere,perplexity,groq,xai,ai21,moonshot,fireworks,electronhub,chutes,nanogpt,aimlapi,siliconflow,zai">
          <label class="diary-setting-item" style="flex-direction: column; align-items: flex-start;">
            <span class="diary-setting-label">模型</span>
            <div class="diary-setting-row">
              <select id="diaryApiModelSelect" class="diary-setting-select" style="flex: 1;">
                <option value="">请选择模型...</option>
                <option value="__manual__">手动输入...</option>
              </select>
              <button id="diaryApiRefreshModels" class="menu_button" title="刷新模型列表">
                <i class="fa-solid fa-rotate"></i>
              </button>
            </div>
          </label>
          <!-- 手动输入模型 -->
          <div id="diaryApiModelManualWrapper" style="display: none; margin-top: 8px;">
            <input type="text" id="diaryApiModelManual" class="text_pole" placeholder="gpt-4o-mini" style="width: 100%;" />
          </div>
        </div>

        <!-- 测试连接 -->
        <button id="diaryApiTest" class="menu_button" style="width: 100%; margin-top: 12px;">
          <i class="fa-solid fa-flask"></i> 测试连接
        </button>

        <!-- 高级参数（折叠式，动态生成） -->
        <div class="diary-api-section" style="margin-top: 12px;">
          <div class="diary-setting-label diary-collapsible-header" id="diaryApiParamsToggle">
            <i class="fa-solid fa-chevron-down" id="diaryApiParamsIcon"></i>
            <span>高级参数</span>
          </div>
          <div id="diaryApiParamsContainer" class="diary-collapsible-content" style="display: block; margin-top: 8px;">
            <!-- 参数将根据选择的 API 格式动态插入 -->
          </div>
        </div>

      </div>

    </div>
  </div>

  <!-- 展开式搜索栏（默认隐藏） -->
  <div class="diary-search-bar" id="diarySearchBar">
    <input type="text" id="diarySearchInput" placeholder="搜索日记..." />
    <span class="fa-solid fa-search"></span>
  </div>

  <!-- 展开式周筛选面板（默认隐藏） -->
  <div class="diary-week-panel" id="diaryWeekPanel">
    <button class="diary-period-nav-btn diary-week-prev-btn" title="上周">
      <span class="fa-solid fa-chevron-left"></span>
    </button>
    <span class="diary-period-label" id="diaryWeekLabel">本周</span>
    <button class="diary-period-nav-btn diary-week-next-btn" title="下周">
      <span class="fa-solid fa-chevron-right"></span>
    </button>
  </div>

  <!-- 展开式月筛选面板（默认隐藏） -->
  <div class="diary-month-panel" id="diaryMonthPanel">
    <button class="diary-period-nav-btn diary-month-prev-btn" title="上月">
      <span class="fa-solid fa-chevron-left"></span>
    </button>
    <span class="diary-period-label" id="diaryMonthLabel">本月</span>
    <button class="diary-period-nav-btn diary-month-next-btn" title="下月">
      <span class="fa-solid fa-chevron-right"></span>
    </button>
  </div>

  <!-- 展开式日期选择器（默认隐藏） -->
  <div class="diary-date-picker-panel" id="diaryDatePickerPanel">
    <input type="date" id="diaryDatePicker" class="diary-date-input" />
    <button class="diary-date-clear-btn" title="清除日期">
      <span class="fa-solid fa-times"></span>
    </button>
  </div>

  <!-- 展开式日期范围选择器（默认隐藏） -->
  <div class="diary-date-range-panel" id="diaryDateRangePanel">
    <span class="diary-date-range-label">从</span>
    <input type="date" id="diaryDateRangeStart" class="diary-date-input" />
    <span class="diary-date-range-label">到</span>
    <input type="date" id="diaryDateRangeEnd" class="diary-date-input" />
    <button class="diary-date-clear-btn" id="diaryDateRangeClear" title="清除日期范围">
      <span class="fa-solid fa-times"></span>
    </button>
  </div>

  <!-- 展开式视觉设置面板（默认隐藏） -->
  <div class="diary-visual-settings-panel" id="diaryVisualPanel">
    <!-- 视觉设置内容将由 diary-visual-settings.js 动态生成 -->
  </div>

  <!-- 轮播图容器 -->
  <div class="diary-slider-wrapper">
    <div class="diary-slider" id="diarySlider">
      <!-- 日记卡片将动态生成 -->
    </div>
  </div>

  <!-- 翻页按钮 -->
  <div class="diary-nav-buttons">
    <button class="diary-nav-btn diary-prev" title="上一篇">
      <span class="fa-solid fa-chevron-left"></span>
    </button>
    <button class="diary-nav-btn diary-next" title="下一篇">
      <span class="fa-solid fa-chevron-right"></span>
    </button>
  </div>

  <!-- 操作按钮 -->
  <div class="diary-actions">
    <!-- 新建按钮（左侧） -->
    <button class="diary-action-btn diary-new" title="新建日记">
      <span class="fa-solid fa-plus"></span>
    </button>

    <!-- AI回复预览按钮（左侧第二个）-->
    <button class="diary-action-btn diary-ai-preview" id="diaryAiPreviewBtn" title="AI回复预览">
      <span class="fa-solid fa-robot"></span>
      <span class="diary-preview-badge" id="diaryPreviewBadge">1</span>
    </button>

    <!-- 右侧按钮组 -->
    <div class="diary-actions-right">
      <button class="diary-action-btn diary-select" title="选择日记发送">
        <span class="fa-solid fa-list-check"></span>
      </button>
      <button class="diary-action-btn diary-send" title="发送消息">
        <span class="fa-solid fa-paper-plane"></span>
      </button>
    </div>
  </div>

  <!-- AI回复预览面板（点击机器人按钮显示） -->
  <div class="diary-ai-preview-panel" id="diaryAiPreviewPanel" style="display: none;">
    <div class="diary-ai-preview-header">
      <span class="diary-ai-preview-title">
        <i class="fa-solid fa-robot"></i> AI 回复预览
      </span>
      <button class="diary-ai-preview-close" id="diaryAiPreviewClose" title="关闭">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="diary-ai-preview-content">
      <div class="diary-ai-preview-hint">
        等待 AI 回复中...
      </div>
      <textarea class="diary-ai-preview-text" id="diaryAiPreviewText" readonly>这里会显示 AI 的原始回复内容。

你可以点击"编辑"按钮修改格式错误的地方，然后点击"解析并应用"让它生效。

示例格式：
[评论]
角色名评论了20251017_123456_789：今天天气不错呢~
路人A评论了20251017_123456_790：确实很舒服！
[/评论]</textarea>
      <div class="diary-ai-preview-actions">
        <button class="diary-ai-preview-action-btn" id="diaryAiPreviewEdit" title="编辑">
          <i class="fa-solid fa-pen"></i> 编辑
        </button>
        <button class="diary-ai-preview-action-btn diary-ai-preview-primary" id="diaryAiPreviewParse" title="解析并应用">
          <i class="fa-solid fa-check"></i> 解析并应用
        </button>
        <button class="diary-ai-preview-action-btn" id="diaryAiPreviewClear" title="清空">
          <i class="fa-solid fa-trash"></i> 清空
        </button>
      </div>
    </div>
  </div>
</div>

<!-- 日记卡片模板（用于JS动态生成） -->
<template id="diaryCardTemplate">
  <div class="diary-card">
    <div class="diary-content">
      <!-- 顶部按钮组（隐私 + 编辑） -->
      <div class="diary-card-top-buttons">
        <button class="diary-privacy-toggle" title="公开">
          <span class="fa-solid fa-eye"></span>
        </button>
        <button class="diary-edit-toggle" title="编辑">
          <span class="fa-solid fa-pencil"></span>
        </button>
      </div>

      <!-- 头部 -->
      <div class="diary-header">
        <div class="diary-day"></div>
        <div class="diary-date"></div>
      </div>

      <!-- 标题 -->
      <div class="diary-title"></div>

      <!-- 内容块列表 -->
      <div class="diary-entries">
        <!-- 动态生成 -->
      </div>

      <!-- 添加评论按钮（放在内容块和评论区之间） -->
      <div class="diary-add-comment-wrapper">
        <button class="diary-add-comment-btn" title="添加评论">
          <span class="fa-solid fa-reply"></span>
          <span>添加评论</span>
        </button>
      </div>

      <!-- 评论区 -->
      <div class="diary-comments">
        <!-- 动态生成评论 -->
      </div>
    </div>
  </div>
</template>

<!-- 内容块模板 -->
<template id="contentBlockTemplate">
  <div class="diary-entry">
    <div class="entry-header">
      <span class="entry-tag"></span>
      <span class="entry-time"></span>
    </div>
    <div class="entry-content"></div>
  </div>
</template>

<!-- 评论模板 -->
<template id="commentTemplate">
  <div class="comment-item">
    <div class="comment-header">
      <span class="comment-author"></span>
      <span class="comment-time"></span>
    </div>
    <div class="comment-content"></div>
    <div class="comment-actions">
      <button class="comment-reply-btn">
        <span class="fa-solid fa-reply"></span> 回复
      </button>
      <button class="comment-delete-btn">
        <span class="fa-solid fa-trash"></span> 删除
      </button>
    </div>
    <div class="comment-replies">
      <!-- 回复的回复（递归） -->
    </div>
  </div>
</template>
